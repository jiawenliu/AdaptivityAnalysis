%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{CONF} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2018}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption
\input{prelude.tex}

\begin{document}

%% Title information
\title[A Programming Framework for Generalization in Adaptive Data Analysis]{A Programming Framework for Generalization in Adaptive Data Analysis}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{Jiawen Liu}
\affiliation{
  \institution{University at Buffalo, SUNY}            %% \institution is required
  \country{USA}                    %% \country is recommended
}
\email{jliu223@buffalo.edu}

\author{Weihao Qu}
\affiliation{
  \institution{University at Buffalo, SUNY}            %% \institution is required
  \country{USA}                    %% \country is recommended
}
\email{weihaoqu@buffalo.edu}

\author{Marco Gaboardi}
\affiliation{
  \institution{University at Buffalo, SUNY}            %% \institution is required
  \country{USA}                    %% \country is recommended
}
\email{gaboardi@buffalo.edu}


\author{Deepak Garg}
\affiliation{
  \institution{MPI-SWS}            %% \institution is required
  \country{DE}                    %% \country is recommended
}
\email{dg@mpi-sws.org}

\author{Jonathan Ullman}
\affiliation{
  \institution{Northeastern University}            %% \institution is required
  \country{USA}                    %% \country is recommended
}
\email{jullman@ccs.neu.edu}




%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
  A data analysis is said to \emph{generalize} when it allows one to draw
  conclusions from the data that are true of the population from which
  the data are sampled. Statistician and data scientist have devised
  several methods aimed to guarantee generalization in  data
  analyses, and avoid in this way overfitting to the
  data. Guaranteeing generalization is more difficult when data
  analyses are \emph{adaptive}: when the result of an analysis depends
  on the result of previous analyses. 

  A recent line of work focuses on methods aimed at guaranteeing
  generalization in adaptive data analysis through the addition of
  carefully calibrated statistical noise to the empirical results of
  the analysis on the sampled data. In these works, the confidence
  intervals on the generalization error that one can achieve for a
  given analysis usually depend on the \emph{level of adaptivity} of
  the analysis: the number of adaptive steps that depend the one on
  the other. 

  In this work we introduce a programming framework, named \THESYSTEM,  aimed at
  supporting the study of the generalization error for adaptive data
  analysis. The main component \THESYSTEM~is a type-and-effect system
  using effects to track the level of adaptivity of a given
  program. Using a trace-based operational semantics and an effect-enriched
  logical relation we show this analysis sound. We propose a
  bidirectional type-checking algorithm which allows us to implement
  the type-and-effect system in an algorithmic way.  Finally, we show how
  to use \THESYSTEM~to estimate confidence intervals on the
  generalization error of different examples. 
\end{abstract}


% %% 2012 ACM Computing Classification System (CSS) concepts
% %% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
% \begin{CCSXML}
% <ccs2012>
% <concept>
% <concept_id>10011007.10011006.10011008</concept_id>
% <concept_desc>Software and its engineering~General programming languages</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003456.10003457.10003521.10003525</concept_id>
% <concept_desc>Social and professional topics~History of programming languages</concept_desc>
% <concept_significance>300</concept_significance>
% </concept>
% </ccs2012>
% \end{CCSXML}

% \ccsdesc[500]{Software and its engineering~General programming languages}
% \ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
%\keywords{keyword1, keyword2, keyword3}  %% \keywords are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle


\section{Introduction}

Text of paper \ldots

\section{\THESYSTEM~informally}
In adaptive data analysis, a data analysis can depend on the result of
previous analysis on the same data. This dependency may affect the
\emph{generalization properties of the data analysis}. To study this phenomenon
in a formal way, we can consider the \emph{statistical query
  model}. In this model, a dataset $X$ consisting of $d$ attributes (columns) and $n$
individuals' data (rows) can be accessed only through an interface to
which one can submit statistical queries. More precisely, suppose that
the type of a row is $R$ (as an example, a row with $d$ binary
attributes would have type $R=\{0,1\}^d$. Then, in the statistical
query model one can access the dataset only by submitting a function
$p:D\to [0,1] $ to it, and obtaining as an answer the average value of
this function $p$ on the rows in the dataset, i.e. the result is the
value $\frac{1}{n}\sum_{i=1}^n p(X_i)$ where
$X_i$ is the row of index $i$ in $X$. While this model is rather
simple, in fact it supports a large of statistics one may be
interested in having over some data.

To support this model, \THESYSTEM\ provides an interface
$\delta:(A\to[0,1])\to [0,1]$ which when prompted with a function $p$ of
type $A\to[0,1]$ returns a value in $[0,1]$, representing the average
of the value obtained by running $p$ on each row in $X$, as described above. To better understand how this model works, let us
consider the program in Figure \ref{fig:nonadaptive}. In this example,
we assume $X\in\{0,1\}^{n\times d}$ and we collect the result of
$k$ queries where the $j$-th queries computes a simple multiplicative correlation between
the attribute $j$ and the last attribute $k$. We can think about the
result of each query as a weight we can assign to each column
describing its correlation with the labels at position $k$.

\begin{figure}
  \centering
  $$
  \begin{array}{l}
    \elet\, \mathrm{nonAdaptive}\, t = \\
\qquad \elet g = \Big (\efix f(j).\lambda k.
	\eif\,  j < k\, \\
\qquad \qquad \qquad\qquad  \qquad \ethen\,  \elet a = \delta(\lambda
    x. ({\tt proj}\, j \, x) * ({\tt proj}\, k\, x))\, 
	\ein\, 
	\econs(a, f (j +1) k)\\
\qquad \qquad \qquad\qquad \qquad \eelse\, [] \Big )\, \ein\, g\, 0\, t\\
  \end{array}
  $$
  \caption{Example of a non-adaptive program.}
  \label{fig:nonadaptive}
\end{figure}

We may wonder what is the bound on the generalization error we can
guarantee in this case. To compute this we first can notice that each
query is the average of the result of the function $f$ over some
records that are sampled independently from the population. Hence, 
we can apply a classical result, known as Hoeffding inequality giving
a bound on the difference between the empirical mean of a set of
random variables and the expected value of the empirical mean. More
precisely, Hoeffding inequality can be stated as follow.
\begin{theorem}[Hoeffding inequality]
Let $R_1,\ldots,R_n$ be $n$ independent random variables such that
$0 \leq R_i\leq 1$. Then, 
$$
\Pr[\frac{1}{n}\sum_{i=1}^n R_i- \mathbf{E}[\frac{1}{n}\sum_{i=1}^n
R_i]\geq t]\leq e^{-2nt^2}
$$
\end{theorem}

Since we assume that the dataset is composed by records that are
samples independently, we can use this result in our case to guarantee
the following generalization result for each query.
\begin{proposition}
Let $R_1,\ldots,R_n$ be $n$ independent random variables such that
$0 \leq R_i\leq 1$. Then, 
$$
\Pr[\frac{1}{n}\sum_{i=1}^n R_i- \mathbf{E}[\frac{1}{n}\sum_{i=1}^n
R_i]\geq t]\leq e^{-2nt^2}
$$
\end{proposition}



let us consider the program in Figure~\ref{fig:two-rounds}, written in the syntax of \THESYSTEM. In this example, we assume that the dat
\begin{figure}
  \centering
  $$
  \begin{array}{l}
    \elet\, \mathrm{twoRounds}\, t = \\
\qquad \elet g = \Big (\efix f(j).\lambda k.
	\eif\,  j < k\, \\
\qquad \qquad \qquad \ethen\,  \elet a = \delta(\lambda x. (x\, j) * (x\, k))\, 
	\ein\, 
	\econs((a,j), f (j +1) k)\\
\qquad \qquad \qquad \eelse\, [] \Big )\, \ein\,\\
\qquad \elet\, l = g\, 0\, t\, \ein\\
\qquad \elet q = \lambda x. \eif\, \big (\mathrm{foldl}\, 
      \big (\lambda
    s. \lambda (a,i). s + (x\, i) * \log(\frac{1 + a}{1 - a} ) \big )\, 0\,
    l \big )\, \ethen\, +1\, \eelse\, -1
		\ein \\
\qquad \delta(q)
  \end{array}
  $$
  \caption{Example of a program with two rounds of adaptivity.}
  \label{fig:two-rounds}
\end{figure}


\section{\THESYSTEM}
\subsection{Syntax}
The language we consider is a typed lambda calculus with expressions
for basic data types, recursion, and special constructions to execute
queries. The grammar is defined as follow:

\begin{table}
\[\begin{array}{llll}
  \mbox{Types} & \type & ::= & \tbool ~|~  \treal ~|~  \tint ~|~   \tint[I] ~|~ \type_1 \times
  \type_2 ~|~ \tarr{\type_1}{\type_2}{\nnatbiA}{\dmap}{\nnatA} ~|~
                              \tlist{\type} ~|~ \tbox{\type}~|~ \\
& & &                      \tforall{\dmap}{\nnatA}{i} \type  ~|~ \texists{i} \type\\
\mbox{Index Term} & \idx, \nnatA & ::= &     i ~|~ n ~|~ \idx_1 + \idx_2 ~|~  \idx_1
                                 - \idx_2 ~|~ \smax{\idx_1}{\idx_2}\\
\mbox{Expr.} & \expr & ::= & x ~|~ \econst ~|~ \distr ~|~ \eop(\expr) ~|~ \expr_1 \eapp \expr_2 ~|~ \efix f(x:\tau).\expr
 ~|~ (\expr_1, \expr_2) ~|~ \eprojl(\expr) ~|~ \eprojr(\expr) ~| \\
%
& & & \etrue ~|~ \efalse ~|~ \eif(\expr_1, \expr_2, \expr_3) ~|~ \eilam \expr  ~|~  \expr \eapp []  ~|~
                            \epack \expr ~|~ \eunpack \expr \eas x
                            \ein \expr ~|~
\\
& & &  \enil ~|~  \econs (
      \expr_1, \expr_2) ~|~ 
      \ecase \expr \eof\, []\mapsto\expr~;\econs(x,xs)\mapsto\expr\\
& & &  \elet  x:q = \expr_1 \ein \expr_2\\
%
\mbox{Distr.} & \distr & ::= & \bernoulli \eapp \expr ~|~ \uniform \eapp \expr_1 \eapp \expr_2\\      
\mbox{Values} & \valr & ::= & \etrue ~|~ \efalse ~|~ \econst ~|~
(\efix f(x).\expr, \env) ~|~ (\valr_1, \valr_2) 
    ~|~ \enil ~|~ \econs (\valr_1, \valr_2)\\
\mbox{Environments} & \env & ::= & x_1 \mapsto \valr_1, \ldots, x_n \mapsto \valr_n\\
\end{array}\]
\caption{Syntax of \THESYSTEM.}
\label{tab:syntax}
\end{table}
where by $\econst$ we denote arbitrary constants, $\eop$ represents a primitive operation (such as a
mechanism), which determines adaptivity. For simplicity, we assume
that $\eop$ can only have type $\tbase \to \tbool$. We make
environments explicit in closures. This is needed for the tracing
semantics later.
\subsection{Tracing Operational Semantics}

\section{Metatheory}

\section{Examples}

\section{Bidirectional Typechecking}

\section{Implementation}



%% Acknowledgments
% \begin{acks}                            %% acks environment is optional
%                                         %% contents suppressed with 'anonymous'
%   %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
%   %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
%   %% acknowledge financial support and will be used by metadata
%   %% extraction tools.
%   This material is based upon work supported by the
%   \grantsponsor{GS100000001}{National Science
%     Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
%   No.~\grantnum{GS100000001}{nnnnnnn} and Grant
%   No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
%   conclusions or recommendations expressed in this material are those
%   of the author and do not necessarily reflect the views of the
%   National Science Foundation.
% \end{acks}


%% Bibliography
%\bibliography{bibfile}


%% Appendix
\appendix
\section{Appendix}

Text of appendix \ldots

\end{document}
